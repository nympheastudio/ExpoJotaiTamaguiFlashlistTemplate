{"version":3,"file":"timetodisplay.js","sourceRoot":"","sources":["../../../src/js/tracing/timetodisplay.tsx"],"names":[],"mappings":"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","sourcesContent":["import { getActiveSpan, Span as SpanClass, spanToJSON, startInactiveSpan } from '@sentry/core';\nimport type { Span,StartSpanOptions  } from '@sentry/types';\nimport { fill, logger } from '@sentry/utils';\nimport * as React from 'react';\n\nimport { getRNSentryOnDrawReporter, nativeComponentExists } from './timetodisplaynative';\nimport type {RNSentryOnDrawNextFrameEvent } from './timetodisplaynative.types';\nimport { setSpanDurationAsMeasurement } from './utils';\n\nlet nativeComponentMissingLogged = false;\n\n/**\n * Flags of active spans with manual initial display.\n */\nexport const manualInitialDisplaySpans = new WeakMap<Span, true>();\n\n/**\n * Flag full display called before initial display for an active span.\n */\nconst fullDisplayBeforeInitialDisplay = new WeakMap<Span, true>();\n\nexport type TimeToDisplayProps = {\n  children?: React.ReactNode;\n  spanName?: string;\n  record?: boolean;\n};\n\n/**\n * Component to measure time to initial display.\n *\n * The initial display is recorded when the component prop `record` is true.\n *\n * <TimeToInitialDisplay record />\n */\nexport function TimeToInitialDisplay(props: TimeToDisplayProps): React.ReactElement {\n  const activeSpan = getActiveSpan();\n  if (activeSpan) {\n    manualInitialDisplaySpans.set(activeSpan, true);\n  }\n\n  return <TimeToDisplay initialDisplay={props.record}>{props.children}</TimeToDisplay>;\n}\n\n/**\n * Component to measure time to full display.\n *\n * The initial display is recorded when the component prop `record` is true.\n *\n * <TimeToInitialDisplay record />\n */\nexport function TimeToFullDisplay(props: TimeToDisplayProps): React.ReactElement {\n  return <TimeToDisplay fullDisplay={props.record}>{props.children}</TimeToDisplay>;\n}\n\nfunction TimeToDisplay(props: {\n  children?: React.ReactNode;\n  initialDisplay?: boolean;\n  fullDisplay?: boolean;\n}): React.ReactElement {\n  const RNSentryOnDrawReporter = getRNSentryOnDrawReporter();\n\n  if (__DEV__ && !nativeComponentMissingLogged && !nativeComponentExists) {\n    nativeComponentMissingLogged = true;\n    // Using setTimeout with a delay of 0 milliseconds to defer execution and avoid printing the React stack trace.\n    setTimeout(() => {\n      logger.warn('TimeToInitialDisplay and TimeToFullDisplay are not supported on the web, Expo Go and New Architecture. Run native build or report an issue at https://github.com/getsentry/sentry-react-native');\n    }, 0);\n  }\n\n  const onDraw = (event: { nativeEvent: RNSentryOnDrawNextFrameEvent }): void => onDrawNextFrame(event);\n\n  return (\n    <>\n      <RNSentryOnDrawReporter\n        onDrawNextFrame={onDraw}\n        initialDisplay={props.initialDisplay}\n        fullDisplay={props.fullDisplay} />\n      {props.children}\n    </>\n  );\n}\n\n/**\n * Starts a new span for the initial display.\n *\n * Returns current span if already exists in the currently active span.\n */\nexport function startTimeToInitialDisplaySpan(\n  options?: Exclude<StartSpanOptions, 'op' | 'name'> & { name?: string; isAutoInstrumented?: boolean },\n): Span | undefined {\n  const activeSpan = getActiveSpan();\n  if (!activeSpan) {\n    logger.warn(`[TimeToDisplay] No active span found to attach ui.load.initial_display to.`);\n    return;\n  }\n\n  if (!(activeSpan instanceof SpanClass)) {\n    logger.warn(`[TimeToDisplay] Active span is not instance of Span class.`);\n    return;\n  }\n\n  const existingSpan = activeSpan.spanRecorder?.spans.find((span) => spanToJSON(span).op === 'ui.load.initial_display');\n  if (existingSpan) {\n    logger.debug(`[TimeToDisplay] Found existing ui.load.initial_display span.`);\n    return existingSpan\n  }\n\n  const initialDisplaySpan = startInactiveSpan({\n    op: 'ui.load.initial_display',\n    name: 'Time To Initial Display',\n    startTimestamp: spanToJSON(activeSpan).start_timestamp,\n    ...options,\n  });\n\n  if (!initialDisplaySpan) {\n    return;\n  }\n\n  if (!options?.isAutoInstrumented) {\n    manualInitialDisplaySpans.set(activeSpan, true);\n  }\n  return initialDisplaySpan;\n}\n\n/**\n * Starts a new span for the full display.\n *\n * Returns current span if already exists in the currently active span.\n */\nexport function startTimeToFullDisplaySpan(\n  options: Omit<StartSpanOptions, 'op' | 'name'> & { name?: string, timeoutMs?: number } = {\n    timeoutMs: 30_000,\n  },\n): Span | undefined {\n  const activeSpan = getActiveSpan();\n  if (!activeSpan) {\n    logger.warn(`[TimeToDisplay] No active span found to attach ui.load.full_display to.`);\n    return;\n  }\n\n  if (!(activeSpan instanceof SpanClass)) {\n    logger.warn(`[TimeToDisplay] Active span is not instance of Span class.`);\n    return;\n  }\n\n  const descendantSpans = activeSpan.spanRecorder?.spans || [];\n\n  const initialDisplaySpan = descendantSpans.find((span) => spanToJSON(span).op === 'ui.load.initial_display');\n  if (!initialDisplaySpan) {\n    logger.warn(`[TimeToDisplay] No initial display span found to attach ui.load.full_display to.`);\n    return;\n  }\n\n  const existingSpan = descendantSpans.find((span) => spanToJSON(span).op === 'ui.load.full_display');\n  if (existingSpan) {\n    logger.debug(`[TimeToDisplay] Found existing ui.load.full_display span.`);\n    return existingSpan;\n  }\n\n  const fullDisplaySpan = startInactiveSpan({\n    op: 'ui.load.full_display',\n    name: 'Time To Full Display',\n    startTimestamp: spanToJSON(initialDisplaySpan).start_timestamp,\n    ...options,\n  });\n  if (!fullDisplaySpan) {\n    return;\n  }\n\n  const timeout = setTimeout(() => {\n    if (spanToJSON(fullDisplaySpan).timestamp) {\n      return;\n    }\n    fullDisplaySpan.setStatus('deadline_exceeded');\n    fullDisplaySpan.end(spanToJSON(initialDisplaySpan).timestamp);\n    setSpanDurationAsMeasurement('time_to_full_display', fullDisplaySpan);\n    logger.warn(`[TimeToDisplay] Full display span deadline_exceeded.`);\n  }, options.timeoutMs);\n\n  fill(fullDisplaySpan, 'end', (originalEnd: SpanClass['end']) => (endTimestamp?: Parameters<SpanClass['end']>[0]) => {\n    clearTimeout(timeout);\n    originalEnd.call(fullDisplaySpan, endTimestamp);\n  });\n\n  return fullDisplaySpan;\n}\n\nfunction onDrawNextFrame(event: { nativeEvent: RNSentryOnDrawNextFrameEvent }): void {\n  logger.debug(`[TimeToDisplay] onDrawNextFrame: ${JSON.stringify(event.nativeEvent)}`);\n  if (event.nativeEvent.type === 'fullDisplay') {\n    return updateFullDisplaySpan(event.nativeEvent.newFrameTimestampInSeconds);\n  }\n  if (event.nativeEvent.type === 'initialDisplay') {\n    return updateInitialDisplaySpan(event.nativeEvent.newFrameTimestampInSeconds);\n  }\n}\n\nfunction updateInitialDisplaySpan(frameTimestampSeconds: number): void {\n  const span = startTimeToInitialDisplaySpan();\n  if (!span) {\n    logger.warn(`[TimeToDisplay] No span found or created, possibly performance is disabled.`);\n    return;\n  }\n\n  const activeSpan = getActiveSpan();\n  if (!activeSpan) {\n    logger.warn(`[TimeToDisplay] No active span found to attach ui.load.initial_display to.`);\n    return;\n  }\n\n  if (spanToJSON(span).parent_span_id !== spanToJSON(activeSpan).span_id) {\n    logger.warn(`[TimeToDisplay] Initial display span is not a child of current active span.`);\n    return;\n  }\n\n  if (spanToJSON(span).timestamp) {\n    logger.warn(`[TimeToDisplay] ${spanToJSON(span).description} span already ended.`);\n    return;\n  }\n\n  span.end(frameTimestampSeconds);\n  span.setStatus('ok');\n  logger.debug(`[TimeToDisplay] ${spanToJSON(span).description} span updated with end timestamp.`);\n\n  if (fullDisplayBeforeInitialDisplay.has(activeSpan)) {\n    fullDisplayBeforeInitialDisplay.delete(activeSpan);\n    updateFullDisplaySpan(frameTimestampSeconds, span);\n  }\n\n  setSpanDurationAsMeasurement('time_to_initial_display', span);\n}\n\nfunction updateFullDisplaySpan(frameTimestampSeconds: number, passedInitialDisplaySpan?: Span): void {\n  const activeSpan = getActiveSpan();\n  if (!activeSpan) {\n    logger.warn(`[TimeToDisplay] No active span found to attach ui.load.full_display to.`);\n    return;\n  }\n\n  if (!(activeSpan instanceof SpanClass)) {\n    logger.warn(`[TimeToDisplay] Active span is not instance of Span class.`);\n    return;\n  }\n\n  const existingInitialDisplaySpan = passedInitialDisplaySpan\n    || activeSpan.spanRecorder?.spans.find((span) => spanToJSON(span).op === 'ui.load.initial_display');\n  const initialDisplayEndTimestamp = existingInitialDisplaySpan && spanToJSON(existingInitialDisplaySpan).timestamp;\n  if (!initialDisplayEndTimestamp) {\n    fullDisplayBeforeInitialDisplay.set(activeSpan, true);\n    logger.warn(`[TimeToDisplay] Full display called before initial display for active span.`);\n    return;\n  }\n\n  const span = startTimeToFullDisplaySpan();\n  if (!span) {\n    logger.warn(`[TimeToDisplay] No span found or created, possibly performance is disabled.`);\n    return;\n  }\n\n  if (spanToJSON(span).timestamp) {\n    logger.warn(`[TimeToDisplay] ${spanToJSON(span).description} span already ended.`);\n    return;\n  }\n\n  span.end(frameTimestampSeconds);\n\n  span.setStatus('ok');\n  logger.debug(`[TimeToDisplay] ${spanToJSON(span).description} span updated with end timestamp.`);\n\n  setSpanDurationAsMeasurement('time_to_full_display', span);\n}\n"]}