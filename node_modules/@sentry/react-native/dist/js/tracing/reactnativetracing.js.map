{"version":3,"file":"reactnativetracing.js","sourceRoot":"","sources":["../../../src/js/tracing/reactnativetracing.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable max-lines */\nimport type { RequestInstrumentationOptions } from '@sentry/browser';\nimport { defaultRequestInstrumentationOptions, instrumentOutgoingRequests } from '@sentry/browser';\nimport type { Hub, IdleTransaction, Transaction } from '@sentry/core';\nimport { getActiveTransaction, getCurrentHub, startIdleTransaction } from '@sentry/core';\nimport type {\n  Event,\n  EventProcessor,\n  Integration,\n  Transaction as TransactionType,\n  TransactionContext,\n} from '@sentry/types';\nimport { logger } from '@sentry/utils';\n\nimport { APP_START_COLD, APP_START_WARM } from '../measurements';\nimport type { NativeAppStartResponse } from '../NativeRNSentry';\nimport type { RoutingInstrumentationInstance } from '../tracing/routingInstrumentation';\nimport { NATIVE } from '../wrapper';\nimport { NativeFramesInstrumentation } from './nativeframes';\nimport { APP_START_COLD as APP_START_COLD_OP, APP_START_WARM as APP_START_WARM_OP, UI_LOAD } from './ops';\nimport { StallTrackingInstrumentation } from './stalltracking';\nimport { cancelInBackground, onlySampleIfChildSpans } from './transaction';\nimport type { BeforeNavigate, RouteChangeContextData } from './types';\nimport {\n  adjustTransactionDuration,\n  getTimeOriginMilliseconds,\n  isNearToNow,\n  setSpanDurationAsMeasurement,\n} from './utils';\n\nexport interface ReactNativeTracingOptions extends RequestInstrumentationOptions {\n  /**\n   * @deprecated Replaced by idleTimeoutMs\n   */\n  idleTimeout: number;\n\n  /**\n   * @deprecated Replaced by maxTransactionDurationMs\n   */\n  maxTransactionDuration: number;\n\n  /**\n   * The time to wait in ms until the transaction will be finished. The transaction will use the end timestamp of\n   * the last finished span as the endtime for the transaction.\n   * Time is in ms.\n   *\n   * Default: 1000\n   */\n  idleTimeoutMs: number;\n\n  /**\n   * The maximum duration (transaction duration + idle timeout) of a transaction\n   * before it will be marked as \"deadline_exceeded\".\n   * If you never want to mark a transaction set it to 0.\n   * Time is in ms.\n   *\n   * Default: 600000\n   */\n  finalTimeoutMs: number;\n\n  /**\n   * The routing instrumentation to be used with the tracing integration.\n   * There is no routing instrumentation if nothing is passed.\n   */\n  routingInstrumentation?: RoutingInstrumentationInstance;\n\n  /**\n   * Does not sample transactions that are from routes that have been seen any more and don't have any spans.\n   * This removes a lot of the clutter as most back navigation transactions are now ignored.\n   *\n   * Default: true\n   */\n  ignoreEmptyBackNavigationTransactions: boolean;\n\n  /**\n   * beforeNavigate is called before a navigation transaction is created and allows users to modify transaction\n   * context data, or drop the transaction entirely (by setting `sampled = false` in the context).\n   *\n   * @param context: The context data which will be passed to `startTransaction` by default\n   *\n   * @returns A (potentially) modified context object, with `sampled = false` if the transaction should be dropped.\n   */\n  beforeNavigate: BeforeNavigate;\n\n  /**\n   * Track the app start time by adding measurements to the first route transaction. If there is no routing instrumentation\n   * an app start transaction will be started.\n   *\n   * Default: true\n   */\n  enableAppStartTracking: boolean;\n\n  /**\n   * Track slow/frozen frames from the native layer and adds them as measurements to all transactions.\n   */\n  enableNativeFramesTracking: boolean;\n\n  /**\n   * Track when and how long the JS event loop stalls for. Adds stalls as measurements to all transactions.\n   */\n  enableStallTracking: boolean;\n\n  /**\n   * Trace User Interaction events like touch and gestures.\n   */\n  enableUserInteractionTracing: boolean;\n}\n\nconst DEFAULT_TRACE_PROPAGATION_TARGETS = ['localhost', /^\\/(?!\\/)/];\n\nconst defaultReactNativeTracingOptions: ReactNativeTracingOptions = {\n  ...defaultRequestInstrumentationOptions,\n  idleTimeout: 1000,\n  maxTransactionDuration: 600,\n  idleTimeoutMs: 1000,\n  finalTimeoutMs: 600000,\n  ignoreEmptyBackNavigationTransactions: true,\n  beforeNavigate: context => context,\n  enableAppStartTracking: true,\n  enableNativeFramesTracking: true,\n  enableStallTracking: true,\n  enableUserInteractionTracing: false,\n};\n\n/**\n * Tracing integration for React Native.\n */\nexport class ReactNativeTracing implements Integration {\n  /**\n   * @inheritDoc\n   */\n  public static id: string = 'ReactNativeTracing';\n  /** We filter out App starts more than 60s */\n  private static _maxAppStart: number = 60000;\n  /**\n   * @inheritDoc\n   */\n  public name: string = ReactNativeTracing.id;\n\n  /** ReactNativeTracing options */\n  public options: ReactNativeTracingOptions;\n\n  public nativeFramesInstrumentation?: NativeFramesInstrumentation;\n  public stallTrackingInstrumentation?: StallTrackingInstrumentation;\n  public useAppStartWithProfiler: boolean = false;\n\n  private _inflightInteractionTransaction?: IdleTransaction;\n  private _getCurrentHub?: () => Hub;\n  private _awaitingAppStartData?: NativeAppStartResponse;\n  private _appStartFinishTimestamp?: number;\n  private _currentRoute?: string;\n  private _hasSetTracePropagationTargets: boolean;\n  private _hasSetTracingOrigins: boolean;\n  private _currentViewName: string | undefined;\n\n  public constructor(options: Partial<ReactNativeTracingOptions> = {}) {\n    this._hasSetTracePropagationTargets = !!(\n      options &&\n      // eslint-disable-next-line deprecation/deprecation\n      options.tracePropagationTargets\n    );\n    this._hasSetTracingOrigins = !!(\n      options &&\n      // eslint-disable-next-line deprecation/deprecation\n      options.tracingOrigins\n    );\n\n    this.options = {\n      ...defaultReactNativeTracingOptions,\n      ...options,\n      finalTimeoutMs:\n        options.finalTimeoutMs ??\n        // eslint-disable-next-line deprecation/deprecation\n        (typeof options.maxTransactionDuration === 'number'\n          ? // eslint-disable-next-line deprecation/deprecation\n            options.maxTransactionDuration * 1000\n          : undefined) ??\n        defaultReactNativeTracingOptions.finalTimeoutMs,\n      idleTimeoutMs:\n        options.idleTimeoutMs ??\n        // eslint-disable-next-line deprecation/deprecation\n        options.idleTimeout ??\n        defaultReactNativeTracingOptions.idleTimeoutMs,\n    };\n  }\n\n  /**\n   *  Registers routing and request instrumentation.\n   */\n  public async setupOnce(\n    addGlobalEventProcessor: (callback: EventProcessor) => void,\n    getCurrentHub: () => Hub,\n  ): Promise<void> {\n    const hub = getCurrentHub();\n    const client = hub.getClient();\n    const clientOptions = client && client.getOptions();\n\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    const {\n      traceFetch,\n      traceXHR,\n      // eslint-disable-next-line deprecation/deprecation\n      tracingOrigins,\n      shouldCreateSpanForRequest,\n      // eslint-disable-next-line deprecation/deprecation\n      tracePropagationTargets: thisOptionsTracePropagationTargets,\n      routingInstrumentation,\n      enableAppStartTracking,\n      enableStallTracking,\n    } = this.options;\n\n    this._getCurrentHub = getCurrentHub;\n\n    const clientOptionsTracePropagationTargets = clientOptions && clientOptions.tracePropagationTargets;\n    // There are three ways to configure tracePropagationTargets:\n    // 1. via top level client option `tracePropagationTargets`\n    // 2. via ReactNativeTracing option `tracePropagationTargets`\n    // 3. via ReactNativeTracing option `tracingOrigins` (deprecated)\n    //\n    // To avoid confusion, favour top level client option `tracePropagationTargets`, and fallback to\n    // ReactNativeTracing option `tracePropagationTargets` and then `tracingOrigins` (deprecated).\n    //\n    // If both 1 and either one of 2 or 3 are set (from above), we log out a warning.\n    const tracePropagationTargets =\n      clientOptionsTracePropagationTargets ||\n      (this._hasSetTracePropagationTargets && thisOptionsTracePropagationTargets) ||\n      (this._hasSetTracingOrigins && tracingOrigins) ||\n      DEFAULT_TRACE_PROPAGATION_TARGETS;\n    if (\n      __DEV__ &&\n      (this._hasSetTracePropagationTargets || this._hasSetTracingOrigins) &&\n      clientOptionsTracePropagationTargets\n    ) {\n      logger.warn(\n        '[ReactNativeTracing] The `tracePropagationTargets` option was set in the ReactNativeTracing integration and top level `Sentry.init`. The top level `Sentry.init` value is being used.',\n      );\n    }\n\n    if (enableAppStartTracking) {\n      this._instrumentAppStart().then(undefined, (reason: unknown) => {\n        logger.error(`[ReactNativeTracing] Error while instrumenting app start:`, reason);\n      });\n    }\n\n    this._enableNativeFramesTracking(addGlobalEventProcessor);\n\n    if (enableStallTracking) {\n      this.stallTrackingInstrumentation = new StallTrackingInstrumentation();\n    }\n\n    if (routingInstrumentation) {\n      routingInstrumentation.registerRoutingInstrumentation(\n        this._onRouteWillChange.bind(this),\n        this.options.beforeNavigate,\n        this._onConfirmRoute.bind(this),\n      );\n    } else {\n      logger.log('[ReactNativeTracing] Not instrumenting route changes as routingInstrumentation has not been set.');\n    }\n\n    addGlobalEventProcessor(this._getCurrentViewEventProcessor.bind(this));\n\n    instrumentOutgoingRequests({\n      traceFetch,\n      traceXHR,\n      shouldCreateSpanForRequest,\n      tracePropagationTargets,\n    });\n  }\n\n  /**\n   * To be called on a transaction start. Can have async methods\n   */\n  public onTransactionStart(transaction: Transaction): void {\n    if (isNearToNow(transaction.startTimestamp)) {\n      // Only if this method is called at or within margin of error to the start timestamp.\n      this.nativeFramesInstrumentation?.onTransactionStart(transaction);\n      this.stallTrackingInstrumentation?.onTransactionStart(transaction);\n    }\n  }\n\n  /**\n   * To be called on a transaction finish. Cannot have async methods.\n   */\n  public onTransactionFinish(transaction: Transaction, endTimestamp?: number): void {\n    this.nativeFramesInstrumentation?.onTransactionFinish(transaction);\n    this.stallTrackingInstrumentation?.onTransactionFinish(transaction, endTimestamp);\n  }\n\n  /**\n   * Called by the ReactNativeProfiler component on first component mount.\n   */\n  public onAppStartFinish(endTimestamp: number): void {\n    this._appStartFinishTimestamp = endTimestamp;\n  }\n\n  /**\n   * Starts a new transaction for a user interaction.\n   * @param userInteractionId Consists of `op` representation UI Event and `elementId` unique element identifier on current screen.\n   */\n  public startUserInteractionTransaction(userInteractionId: {\n    elementId: string | undefined;\n    op: string;\n  }): TransactionType | undefined {\n    const { elementId, op } = userInteractionId;\n    if (!this.options.enableUserInteractionTracing) {\n      logger.log('[ReactNativeTracing] User Interaction Tracing is disabled.');\n      return;\n    }\n    if (!this.options.routingInstrumentation) {\n      logger.error(\n        '[ReactNativeTracing] User Interaction Tracing is not working because no routing instrumentation is set.',\n      );\n      return;\n    }\n    if (!elementId) {\n      logger.log('[ReactNativeTracing] User Interaction Tracing can not create transaction with undefined elementId.');\n      return;\n    }\n    if (!this._currentRoute) {\n      logger.log('[ReactNativeTracing] User Interaction Tracing can not create transaction without a current route.');\n      return;\n    }\n\n    const hub = this._getCurrentHub?.() || getCurrentHub();\n    const activeTransaction = getActiveTransaction(hub);\n    const activeTransactionIsNotInteraction =\n      activeTransaction?.spanId !== this._inflightInteractionTransaction?.spanId;\n    if (activeTransaction && activeTransactionIsNotInteraction) {\n      logger.warn(\n        `[ReactNativeTracing] Did not create ${op} transaction because active transaction ${activeTransaction.name} exists on the scope.`,\n      );\n      return;\n    }\n\n    if (this._inflightInteractionTransaction) {\n      this._inflightInteractionTransaction.cancelIdleTimeout(undefined, { restartOnChildSpanChange: false });\n      this._inflightInteractionTransaction = undefined;\n    }\n\n    const name = `${this._currentRoute}.${elementId}`;\n    const context: TransactionContext = {\n      name,\n      op,\n      trimEnd: true,\n    };\n    this._inflightInteractionTransaction = this._startIdleTransaction(context);\n    this._inflightInteractionTransaction.registerBeforeFinishCallback((transaction: IdleTransaction) => {\n      this._inflightInteractionTransaction = undefined;\n      this.onTransactionFinish(transaction);\n    });\n    this._inflightInteractionTransaction.registerBeforeFinishCallback(onlySampleIfChildSpans);\n    this.onTransactionStart(this._inflightInteractionTransaction);\n    logger.log(`[ReactNativeTracing] User Interaction Tracing Created ${op} transaction ${name}.`);\n    return this._inflightInteractionTransaction;\n  }\n\n  /**\n   * Enables or disables native frames tracking based on the `enableNativeFramesTracking` option.\n   */\n  private _enableNativeFramesTracking(addGlobalEventProcessor: (callback: EventProcessor) => void): void {\n    if (this.options.enableNativeFramesTracking && !NATIVE.enableNative) {\n      // Do not enable native frames tracking if native is not available.\n      logger.warn(\n        '[ReactNativeTracing] NativeFramesTracking is not available on the Web, Expo Go and other platforms without native modules.',\n      );\n      return;\n    }\n\n    if (!this.options.enableNativeFramesTracking && NATIVE.enableNative) {\n      // Disable native frames tracking when native available and option is false.\n      NATIVE.disableNativeFramesTracking();\n      return;\n    }\n\n    if (!this.options.enableNativeFramesTracking) {\n      return;\n    }\n\n    NATIVE.enableNativeFramesTracking();\n    this.nativeFramesInstrumentation = new NativeFramesInstrumentation(addGlobalEventProcessor, () => {\n      const self = getCurrentHub().getIntegration(ReactNativeTracing);\n\n      if (self) {\n        return !!self.nativeFramesInstrumentation;\n      }\n\n      return false;\n    });\n  }\n\n  /**\n   *  Sets the current view name into the app context.\n   *  @param event Le event.\n   */\n  private _getCurrentViewEventProcessor(event: Event): Event {\n    if (event.contexts && this._currentViewName) {\n      event.contexts.app = { view_names: [this._currentViewName], ...event.contexts.app };\n    }\n    return event;\n  }\n\n  /**\n   * Returns the App Start Duration in Milliseconds. Also returns undefined if not able do\n   * define the duration.\n   */\n  private _getAppStartDurationMilliseconds(appStart: NativeAppStartResponse): number | undefined {\n    if (!this._appStartFinishTimestamp) {\n      return undefined;\n    }\n    return this._appStartFinishTimestamp * 1000 - appStart.appStartTime;\n  }\n\n  /**\n   * Instruments the app start measurements on the first route transaction.\n   * Starts a route transaction if there isn't routing instrumentation.\n   */\n  private async _instrumentAppStart(): Promise<void> {\n    if (!this.options.enableAppStartTracking || !NATIVE.enableNative) {\n      return;\n    }\n\n    const appStart = await NATIVE.fetchNativeAppStart();\n\n    if (!appStart || appStart.didFetchAppStart) {\n      return;\n    }\n\n    if (!this.useAppStartWithProfiler) {\n      this._appStartFinishTimestamp = getTimeOriginMilliseconds() / 1000;\n    }\n\n    if (this.options.routingInstrumentation) {\n      this._awaitingAppStartData = appStart;\n    } else {\n      const idleTransaction = this._createRouteTransaction({\n        name: 'App Start',\n        op: UI_LOAD,\n      });\n\n      if (idleTransaction) {\n        this._addAppStartData(idleTransaction, appStart);\n      }\n    }\n  }\n\n  /**\n   * Adds app start measurements and starts a child span on a transaction.\n   */\n  private _addAppStartData(transaction: IdleTransaction, appStart: NativeAppStartResponse): void {\n    const appStartDurationMilliseconds = this._getAppStartDurationMilliseconds(appStart);\n    if (!appStartDurationMilliseconds) {\n      logger.warn('App start was never finished.');\n      return;\n    }\n\n    // we filter out app start more than 60s.\n    // this could be due to many different reasons.\n    // we've seen app starts with hours, days and even months.\n    if (appStartDurationMilliseconds >= ReactNativeTracing._maxAppStart) {\n      return;\n    }\n\n    const appStartTimeSeconds = appStart.appStartTime / 1000;\n\n    transaction.startTimestamp = appStartTimeSeconds;\n\n    const maybeTtidSpan = transaction.spanRecorder?.spans.find(span => span.op === 'ui.load.initial_display');\n    if (maybeTtidSpan) {\n      maybeTtidSpan.startTimestamp = appStartTimeSeconds;\n      setSpanDurationAsMeasurement('time_to_initial_display', maybeTtidSpan);\n    }\n\n    const maybeTtfdSpan = transaction.spanRecorder?.spans.find(span => span.op === 'ui.load.full_display');\n    if (maybeTtfdSpan) {\n      maybeTtfdSpan.startTimestamp = appStartTimeSeconds;\n      setSpanDurationAsMeasurement('time_to_full_display', maybeTtfdSpan);\n    }\n\n    const op = appStart.isColdStart ? APP_START_COLD_OP : APP_START_WARM_OP;\n    transaction.startChild({\n      description: appStart.isColdStart ? 'Cold App Start' : 'Warm App Start',\n      op,\n      startTimestamp: appStartTimeSeconds,\n      endTimestamp: this._appStartFinishTimestamp,\n    });\n\n    const measurement = appStart.isColdStart ? APP_START_COLD : APP_START_WARM;\n    transaction.setMeasurement(measurement, appStartDurationMilliseconds, 'millisecond');\n  }\n\n  /** To be called when the route changes, but BEFORE the components of the new route mount. */\n  private _onRouteWillChange(context: TransactionContext): TransactionType | undefined {\n    return this._createRouteTransaction(context);\n  }\n\n  /**\n   * Creates a breadcrumb and sets the current route as a tag.\n   */\n  private _onConfirmRoute(context: TransactionContext): void {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n    this._currentRoute = context.data?.route?.name;\n\n    this._getCurrentHub?.().configureScope(scope => {\n      if (context.data) {\n        const contextData = context.data as RouteChangeContextData;\n\n        scope.addBreadcrumb({\n          category: 'navigation',\n          type: 'navigation',\n          // We assume that context.name is the name of the route.\n          message: `Navigation to ${context.name}`,\n          data: {\n            from: contextData.previousRoute?.name,\n            to: contextData.route.name,\n          },\n        });\n      }\n\n      this._currentViewName = context.name;\n      /**\n       * @deprecated tag routing.route.name will be removed in the future.\n       */\n      scope.setTag('routing.route.name', context.name);\n    });\n  }\n\n  /** Create routing idle transaction. */\n  private _createRouteTransaction(context: TransactionContext): IdleTransaction | undefined {\n    if (!this._getCurrentHub) {\n      logger.warn(`[ReactNativeTracing] Did not create ${context.op} transaction because _getCurrentHub is invalid.`);\n      return undefined;\n    }\n\n    if (this._inflightInteractionTransaction) {\n      logger.log(\n        `[ReactNativeTracing] Canceling ${this._inflightInteractionTransaction.op} transaction because navigation ${context.op}.`,\n      );\n      this._inflightInteractionTransaction.setStatus('cancelled');\n      this._inflightInteractionTransaction.finish();\n    }\n\n    const { finalTimeoutMs } = this.options;\n\n    const expandedContext = {\n      ...context,\n      trimEnd: true,\n    };\n\n    const idleTransaction = this._startIdleTransaction(expandedContext);\n\n    this.onTransactionStart(idleTransaction);\n\n    logger.log(`[ReactNativeTracing] Starting ${context.op} transaction \"${context.name}\" on scope`);\n\n    idleTransaction.registerBeforeFinishCallback((transaction, endTimestamp) => {\n      this.onTransactionFinish(transaction, endTimestamp);\n    });\n\n    idleTransaction.registerBeforeFinishCallback(transaction => {\n      if (this.options.enableAppStartTracking && this._awaitingAppStartData) {\n        transaction.op = UI_LOAD;\n        this._addAppStartData(transaction, this._awaitingAppStartData);\n\n        this._awaitingAppStartData = undefined;\n      }\n    });\n\n    idleTransaction.registerBeforeFinishCallback((transaction, endTimestamp) => {\n      adjustTransactionDuration(finalTimeoutMs, transaction, endTimestamp);\n    });\n\n    if (this.options.ignoreEmptyBackNavigationTransactions) {\n      idleTransaction.registerBeforeFinishCallback(transaction => {\n        if (\n          // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n          transaction.data?.route?.hasBeenSeen &&\n          (!transaction.spanRecorder ||\n            transaction.spanRecorder.spans.filter(\n              span =>\n                span.spanId !== transaction.spanId &&\n                span.op !== 'ui.load.initial_display' &&\n                span.op !== 'navigation.processing',\n            ).length === 0)\n        ) {\n          logger.log(\n            '[ReactNativeTracing] Not sampling transaction as route has been seen before. Pass ignoreEmptyBackNavigationTransactions = false to disable this feature.',\n          );\n          // Route has been seen before and has no child spans.\n          transaction.sampled = false;\n        }\n      });\n    }\n\n    return idleTransaction;\n  }\n\n  /**\n   * Start app state aware idle transaction on the scope.\n   */\n  private _startIdleTransaction(context: TransactionContext): IdleTransaction {\n    const { idleTimeoutMs, finalTimeoutMs } = this.options;\n    const hub = this._getCurrentHub?.() || getCurrentHub();\n    const tx = startIdleTransaction(hub, context, idleTimeoutMs, finalTimeoutMs, true);\n    cancelInBackground(tx);\n    return tx;\n  }\n}\n"]}